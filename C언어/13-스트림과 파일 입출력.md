# 스트림과 파일 입출력

## 스트림
스트림(stream)이란 순서가 있는 데이터를 입력받거나 출력할 때 해당 장치로부터 데이터가 한쪽으로 흘러가는 것을 의미한다.

스트림을 사용하면 장치별로 독립해서 입출력할 수 있어 모니터로 출력한 데이터를 파일이나 프린터로 출력할 때도 같은 방법으로 처리할 수 있다.

### 스트림과 버퍼의 관계
스트림에는 버퍼가 포함되어 있다.

버퍼는 장치와 프로그램 사시에 전송 되는 데이터를 임시로 저장하는 메모리 공간이다.

버퍼를 사용하는 이유는 입출력 데이터를 일정량 모아두었다가 한꺼번에 처리하여 디스크 접근 시간과 프로그램 수행으로 인한 지연 시간을 줄일 수 있기 때문이다.

입력 버퍼는 키보드로 입력한 데이터를 버퍼에 채우다가 [enter]가 입력되면 보관된 데이터를 전송한다.

출력 버퍼는 줄바꿈 문자(\n)를 입력 받으면 버퍼에 보관된 데이터를 모니터로 출력한다.

### 표준 입출력 스트림
입출력 효율성이 크게 떨어지는 불편함을 해결하기 위해 버퍼를 사용한다. 

입출력할 데이터를 메모리 버퍼에 보관하고 버퍼가 채워지면 비로소 입출력을 처리한다.

표준 입출력 스트림은 프로그래머가 일일이 하지 않아도 자동으로 생성된다.

표준 입출력 스트림은 프로그램을 시작할 때 자동으로 생성되고, 프로그램이 종료되면 자동으로 소멸된다.

<pre>표준 입출력 스트림의 역할과 사용 함수
<code>
스트림     |   연결 장치   |      역할       |   사용 함수
stdin     |    키보드     |    표준 입력     |  scanf_s()
stdout    |    모니터     |    표준 출력     | printf()
stderr    |    모니터     |  표준 에러 출력  | 오류 출력 시스템</code></pre>
이러한 스트림이 존재하고, 자동으로 생성되고 소멸된다는 것만 알고 넘어가도록 한다.

## 파일 입출력 

### 파일 포인터와 FILE형 구조체
#### 파일 포인터
C언어에서는 파일 처리를 위해 스트림을 사용하며 파일 입출력을 위한 파일 포인터를 가장 먼저 선언해야 한다.

파일 포인터는 실제 파일과 프로그램을 연결해 주는 통로로 사용되며 이를 위해 FILE형 구조체를 가리키는 포인터 변수 정의가 필요하다.

이러한 작업을 수행해야만 입출력할 파일을 열고 작업할 수 있다.

#### FILE형 구조체
포인터 변수를 선언하고 파일과 관련한 입출력 함수를 호출할 때마다 이 변수를 사용한다.

FILE형 구조체는 <stdio.h> 헤더 파일에 이미 선언되어 있으므로 사용자가 별도로 FILE형 구조체를 선언하지 않아도 된다.

#### 파일 입출력 함수 
C언어에서 대부분의 입출력 함수는 버퍼를 사용한다.

<pre>파일 입출력 함수의 종류
<code>
fopen_s()     // 파일 열기
fclose()      // 파일 닫기
fread()       // 블록 단위로 데이터 읽기
fwrite()      // 블록 단위로 데이터 출력하기
fscanf_s()    // 지정된 서식으로 데이터 읽기
fprintf()     // 지정된 서식으로 데이터 출력하기
fgetc, getc() // 문자 한 개 읽기
fputc(), putc()   // 문자 한 개 출력하기
fgets()       // 문자열 읽기
fputs()       // 문자열 출력하기
feof()        // 문자열 끝 검출하기
ftell()       // 현재 파일 포인터의 위치 파악하기
fseek()       // 파일 포인터의 위치 이동하고
gets_s()      // 표준 입력 스트림의 버퍼에서 문자열 읽기
rewind()      // 파일 포인터의 위치를 파일의 시작 위치로 이동하기  </code></pre>
자주 사용하는 파일 입출력 함수는 다음과 같다.

#### 파일 열기 함수와 닫기 함수
파일을 열기 위해서는 fopen_s() 함수를 사용해야한다. 

파일을 열면 FILE형 포인터가 반환되는데 이는 실제 파일을 처리하는 데 필요한 버퍼 공간을 사용하기 위해서 FILE형 포인터가 반환된다.

<pre>fopen_s() 함수에서 사용하는 파일 모드의 종류
<code>
r     // 파일을 처음부터 읽기 위해 열기, 파일이 존재하지 않으면 오류 발생
r+    // 이미 존재하는 파일을 읽기와 쓰기로 열기, 파일이 존재하지 않으면 오류 발생
w     // 파일을 무조건 새로 생성하여 처음부터 쓰기 위해 열기, 이미 존재하는 파일 내용은 삭제
w+    // 파일을 무조건 생성하여 읽기와 쓰기로 열기, 이미 존재하는 파일 내용은 삭제
a     // 파일 끝에 새로운 내용을 추가하기 위해 열기, 파일이 없으면 새로 생성
a+    // 파일 끝에 새로운 내용을 추가하거나 읽기 위해 열기, 파일이 없으면 새로 생성
b     // 파일을 바이너리 모드로 욜기, [ctrl + z]로 파일 끝을 알리는 EOF로 변환
t     // 파일을 텍스트 모드로 열기, 데이터를 아스키 코드로 인식 </code></pre>
파일을 텍스트 모드로 여는 t는 생략해도 되지만 바이너리 모드로 여는 b는 절대로 생략해선 안된다.

<pre>파일 생성 형식
<code>
FILE *fp;     
errno_t err;
err = fopen_s(&fp, "파일 이름", "파일 모드");
if (err = 0)
  printf("파일 열기 성공");
else
  printf("파일 열기 실패");   </code></pre>
fopen_s()와 같이 선언하여 파일을 열 때 에러가 발생하지 않으면 0의 값을 변수 err에 반환하고 에러가 발생하면 0이외의 값을 반환한다.

파일 열기에 성공하면 포인터 변수가 NULL 값을 가지지 않으므로 if (NULL != fp)와 같이 선언해도 된다.

fopen_s()함수로 파일을 열어서 사용했다면 사용 후에는 반드시 fclose()함수로 닫아야 한다.

<pre>파일 열고 닫기
<code>
#include<stdio.h>
int main(void)
{
	FILE* fp;
	errno_t err;

	err = fopen_s(&fp, "sample.txt", "w");    // 쓰기 모드로 파일 열기

	if (fp == NULL)
		printf("파일 열기 실패\n");
	else
	{
		printf("파일 열기 성공\n");
		fclose(fp);       // 파일 닫기 
	}
	return 0;
} </code></pre>
파일을 열고 닫는 예제를 실행해 보았다.

if (fp == NULL)이면 포인터 변수가 NULL의 값을 가진 것이므로 파일 열기에 실패한 것이다.

<pre>fprintf()로 파일에 문자열 출력
<code>
#include<stdio.h>

int main(void)
{
	FILE* fp;
	errno_t err;

	err = fopen_s(&fp, "sample.txt", "wt");		// 쓰기 모드로 텍스트 파일 열기

	if (NULL != fp)		// 파일 열기에 성공한 경우
	{
		printf("1.새로운 파일 생성후 문자열 저장 완료\n");
		fprintf(fp, "Happy Day\n");
		printf("2.윈도우 탐색기에서 sample.txt 파일 내용 확인 \n");
		fclose(fp);
	}		
	else        // 파일 열기에 실패한 경우
		printf("파일열기 실패\n");
	return 0;
}</code></pre>
쓰기 모드로 텍스트 파일을 생성한 다음 fprintf()함수를 사용하여 문자열을 텍스트 파일에 출력하는 프로그램이다.

새롭게 생성되는 텍스트 파일은 프로그램 소스 코드가 존재하는 폴더 안에 생성된다.

<pre>fscanf_s()함수 사용 형식
<code>
int n1, n2, n3;
FILE *fp;
'''
fscanf_s(fp, "%d %d %d", &n1, &n2, &n3);
// fscanf_s(파일 포인터, "데이터 형식", 변수 목록); </code></pre>
fscanf_s() 함수는 텍스트 파일에서 문자열을 읽어올 때 사용한다.

소스 코드와 똑같은 경로에 텍스트 파일을 생성해 두어야 한다.

<pre>fgets()로 파일의 문자열을 줄 단위로 가져오기
<code>
insa.txt 
  Have a good time
  Congratualtions on your success.
  
'''
#include<stdio.h>

int main(void)
{
	char good[80];
	FILE* fp;
	errno_t err;

	err = fopen_ s(&fp, "insa.txt", "rt");      // 읽기 모드로 텍스트 파일 열기

	if (NULL != fp)     // 파일 열기에 성공한 경우
	{
		printf("파일 열기 성공\n");
	      	/*
		      	while ( EOF != fscanf_s(fp, "%d", &num))
		      {
			      printf("%d \n", num);
		      	}
	      	*/
		while (NULL != fgets(good, sizeof(good),fp))
		{
			printf(" %s", good);    // 텍스트 문자열에 줄 바꿈 적용되므로 \n 생략
		}
		fclose(fp);
	}
	else            // 파일 열기에 실패한 경우
		printf("파일 열기 실패\n");
	return 0;
} </code></pre>
텍스트 파일에서 줄 단위로 문자열을 처리하려면 fgets()함수를 사용해야 한다.

미리 insa.txt 텍스트 파일을 만들어 주고, 텍스프 파일에 저장되어 있는 문자열을 줄 단위로 읽어와 화면에 출력하는 프로그램이다.

